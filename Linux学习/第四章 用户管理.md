## 1. Users和Groups

在任何传统操作系统里，都有用户和组。它们的存在完全是为了访问和权限。当运行一个进程时，它将以该进程的所有者身份运行，无论是 Jane 还是 Bob。文件访问和所有权也依赖于权限。你不会希望 Jane 能看到 Bob 的文档，反之亦然。

每个用户都有自己的主目录，他们的特定文件会存储在这里，这通常位于/home/username，但在不同的发行版中可能会有所不同。

系统使用用户 ID（UID）来管理用户，用户名是友好地关联用户与身份的方式，但系统通过 UID 来识别用户。系统也使用组来管理权限，组只是具有该组权限的用户集合，它们通过系统识别的组 ID（GID）来标识。

在 Linux 中，除了正常使用系统的用户外，还会有一些特殊用户。有时这些用户是系统守护进程，它们持续运行进程以保持系统运行。其中最重要的用户是 root 或超级用户，root 是系统上权限最高的用户，它可以访问任何文件并启动和终止任何进程。因此，一直以 root 身份操作可能很危险，你可能会误删系统关键文件。幸运的是，如果需要 root 权限且用户具有 root 权限，他们可以使用 sudo 命令以 root 身份运行命令。sudo 命令（superuser do）用于以 root 权限运行命令，我们将在后续课程中更深入地探讨用户如何获得 root 权限。

尝试查看一个受保护的文件，例如/etc/shadow：

```Shell
cat /etc/shadow
```

注意，你收到了权限 denied 的错误，使用以下命令查看权限：

```Shell
ls -la /etc/shadow


-rw-r----- 1 root shadow 1134 Dec 1 11:45 /etc/shadow
```  

我们还没有学习权限，但这里发生的情况是，root 是文件的所有者，你需要 root 权限或属于 shadow 组才能读取内容。现在使用 sudo 运行该命令：

```Shell
sudo cat /etc/shadow
```

现在你可以看到文件的内容了！

## 2. root

我们看了一种使用 sudo 命令获取超级用户访问权限的方法。你也可以使用 su 命令以超级用户身份运行命令。这个命令会"替换用户"，如果未指定用户名，则会打开 root shell。只要你知道密码，就可以使用此命令替换为任何用户。

```Shell
su
```

使用这种方法有一些缺点：在 root 下运行所有命令更容易犯严重错误，你不会有用来更改系统配置的命令记录等。基本上，如果你需要以超级用户身份运行命令，只需坚持使用 sudo。

现在你知道了哪些命令需要以超级用户身份运行，问题是如何知道谁有权这样做？系统不会让每个普通人都以超级用户身份运行命令，那么它是如何知道的？有一个名为/etc/sudoers 的文件，这个文件列出了可以运行 sudo 的用户。你可以使用 **visudo** 命令编辑此文件。

## 3. /etc/passwd

记住，用户名并不是用户的真正标识。系统使用用户 ID（UID）来识别用户。要了解哪些用户映射到哪个 ID，可以查看 /etc/passwd 文件。

```Shell
cat /etc/passwd
```

该文件显示用户列表及其详细信息。例如，该文件的第一行很可能看起来像这样：

```Shell
root:x:0:0:root:/root:/bin/bash
```

每一行显示一个用户的信息，通常你会看到 root 用户作为第一行。有许多用冒号分隔的字段，提供了关于用户的更多信息，让我们逐一查看它们：

1. 用户名
2. 用户的密码 - 密码并不真正存储在这个文件中，它通常存储在 /etc/shadow 文件中。我们将在下一课中更详细地讨论 /etc/shadow，但暂时要知道它包含加密的用户密码。你可以看到这个字段中有许多不同的符号，如果看到 "x" 表示密码存储在 /etc/shadow 文件中，"*" 表示用户没有登录权限，如果字段为空白表示用户没有密码。
3. 用户 ID - 正如你所见，root 的用户 ID 是 0
4. 组 ID
5. GECOS 字段 - 这通常用于留下关于用户或账户的评论，例如他们的真实姓名或电话号码，以逗号分隔。
6. 用户的家目录
7. 用户的 shell - 你可能会发现很多用户默认使用 bash 作为他们的 shell

通常在用户的设置页面，你期望看到的是普通用户。然而，你会发现/etc/passwd 文件中包含其他用户。记住，用户实际上只是用来以不同权限运行进程。有时我们希望以预定的权限运行进程。例如，守护用户用于守护进程。

还应该注意的是，如果你想要添加用户和修改信息，可以通过手动编辑/etc/passwd 文件，使用工具 **vipw**，但是这类操作最好留给我们在后续课程中讨论的工具，如 useradd 和 userdel。

## 4. /etc/shadow

/etc/shadow 文件用于存储用户认证信息。它需要超级用户读取权限。

```Shell
sudo cat /etc/shadow

root:MyEPTEa$6Nonsense:15000:0:99999:7:::
```

你会注意到它与/etc/passwd 的内容非常相似，但在密码字段中你会看到一个加密的密码。字段之间用冒号分隔，如下所示：

1. 用户名
2. 加密密码
3. 上次修改密码的日期——以自1970年1月1日以来的天数表示。如果有一个0，则表示用户应在下次登录时更改密码
4. 最小密码年龄 - 用户必须等待的天数才能再次更改密码
5. 最大密码年龄 - 用户必须更改密码的最大天数
6. 密码警告期 - 密码即将过期前的天数
7. 密码非活动期 - 密码过期后允许使用密码登录的天数
8. 账户过期日期 - 用户将无法登录的日期
9. 保留字段用于未来使用

在当今的大多数发行版中，用户认证并不依赖于仅有的 /etc/shadow 文件，还有其他机制在运行，例如 PAM（可插拔认证模块）来替代认证。

## 5. /etc/group

另一个用于用户管理的文件是 /etc/group 文件。该文件允许设置具有不同权限的不同组。

```
cat /etc/group

root:*:0:pete
```
  

与 /etc/password 字段非常相似，/etc/group 字段的格式如下：

1. 组名
2. 组密码 - 不需要设置组密码，使用 sudo 等提升权限是标准做法。默认值将设为"*"。
3. 组 ID (GID)
4. 用户列表 - 你可以手动指定想要加入特定组的用户

## 6. 用户管理工具

大多数企业环境使用管理系统来管理用户、账户和密码。然而，在单机计算机上也有有用的命令来运行以管理用户。

**添加用户**

您可以使用 adduser 或 useradd 命令。adduser 命令包含更多有用的功能，例如创建主目录等。有用于添加新用户的配置文件，可以根据您想要分配给默认用户的配置进行自定义。

```Shell
sudo useradd bob
```

你会看到上述命令为 bob 在/etc/passwd 中创建了一个条目，设置了默认组，并向/etc/shadow 文件中添加了一个条目。

**删除用户**

要删除用户，你可以使用 userdel 命令。

```Shell
sudo userdel bob
```

这基本上会尽力撤销 useradd 所做的文件更改。

**修改密码**

```Shell
passwd bob
```

这将允许你修改自己或另一个用户（如果你是 root）的密码。