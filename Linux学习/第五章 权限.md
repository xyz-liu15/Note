
## 1. 文件权限

如前所述，文件具有不同的权限或文件模式。让我们看一个例子：

```Shell
ls -l Desktop/
  
drwxr-xr-x 2 pete penguins 4096 Dec 1 11:45 .
```
  

文件的权限分为四部分。第一部分是文件类型，由权限中的第一个字符表示，在我们的例子中，因为我们正在查看一个目录，它显示为 **d** 表示文件类型。通常情况下，你会看到一个 **-** 表示普通文件。

文件模式的下三部分是实际的权限。权限被分为每三位一组。前三位是用户权限，然后是组权限，最后是其他权限。我添加了管道符号以便更容易区分。

d | rwx | r-x | r-x 

每个字符代表不同的权限：  

- r：可读
- w：可写
- x：可执行（基本上是一个可执行程序）
- -: empty

所以在上述示例中，我们看到用户 pete 对文件具有读、写和执行权限。群组 penguins 具有读和执行权限。最后，其他用户（所有人）具有读和执行权限。

## 2. 修改权限

更改权限可以通过 **chmod** 命令轻松完成。

首先，选择要更改的权限集，是用户、组还是其他。你可以使用 **+** 或 **-** 添加或移除权限，让我们看一些例子。

**在文件上添加权限位**  

```Shell
chmod u+x myfile
```

上述命令的意思是：更改 myfile 的权限，通过在用户组上添加可执行权限位。现在用户对此文件具有可执行权限！

**移除文件上的权限位**  

```Shell
chmod u-x myfile
```

**在文件上添加多个权限位**  

```Shell
chmod ug+w
```

还有另一种使用数字格式更改权限的方法。这种方法允许你一次性更改所有权限。不再使用 r、w 或 x 来表示权限，而是使用一个数字来表示单个权限集。因此无需使用 g 指定组或 u 指定用户。

数值表示如下：

- 4：读权限
- 2：写权限
- 1：执行权限

让我们来看一个例子：

$ chmod 755 myfile

你能猜出我们给这个文件设置了什么权限吗？让我们来分解一下，现在755涵盖了所有组的权限。第一个数字（7）代表用户权限，第二个数字（5）代表组权限，最后一个5代表其他权限。

等等，7和5在上面没有列出，我们从哪里得到这些数字？记住我们现在是将所有权限合并为一个数字，所以你需要用到一些数学知识。

7 = 4 + 2 + 1，所以7是用户权限，它具有读、写和执行权限

5 = 4 + 1, 该组具有读取和执行权限

5 = 4 +1，并且所有其他用户具有读取和执行权限

需要注意的一点是：随意更改权限并不是一个好主意，你可能会无意中暴露一个敏感文件供所有人修改。然而，无论你多么有正当理由要更改权限，使用 chmod 命令时都要谨慎。

## 3. 所有权权限

除了修改文件权限外，你还可以修改文件的用户组和用户所有权。

**修改用户所有权**

```Shell
sudo chown patty myfile
```

此命令将 myfile 的所有者设置为 patty。

**修改组所有权**

```Shell
sudo chgrp whales myfile
```

该命令将 myfile 的组设置为 whales。

**同时修改用户和组所有权**  
如果你在用户名后添加冒号和组名，可以同时设置用户和组。

```Shell
sudo chown patty:whales myfile
```

## 4. Umask

每个创建的文件都附带一组默认权限。如果您想更改默认权限集，可以使用umask命令。这个命令接受我们在数字权限中看到的3位权限集。然而，umask并不是添加这些权限，而是移除这些权限。

```Shell
umask 021
```
在上面的例子中，我们表示希望新文件的默认权限允许用户访问一切，但对于组，我们希望移除他们的写权限，对于其他用户，我们希望移除他们的可执行权限。大多数发行版的默认umask是022，这意味着所有用户都可以访问，但组和其他用户没有写权限。

当您运行umask命令时，它将在您创建的任何新文件上提供默认权限集。但是，如果您想让它持续生效，您必须修改您的启动文件（.profile），但我们将在以后的课程中讨论这个问题。

## 5. Setuid

很多时候，普通用户需要提升权限来执行某些操作。系统管理员不可能每次用户需要访问受保护文件时都输入 root 密码，因此存在特殊的文件权限位来允许这种行为。Set User ID（SUID）允许用户以程序文件的所有者身份运行程序，而不是以他们自己的身份。

让我们来看一个例子：

假设我想修改我的密码，很简单对吧？我只需要使用 passwd 命令：

```Shell
passwd
```

密码命令在做什么？它在修改几个文件，但最重要的是它在修改 /etc/shadow 文件。让我们再看一下这个文件：

```Shell
ls -l /etc/shadow

-rw-r----- 1 root shadow 1134 Dec 1 11:45 /etc/shadow
```
  

等等，这个文件是 root 拥有的？我们怎么可能能够修改一个 root 拥有的文件？

让我们看看另一个权限集，这次是我们运行的命令的权限集：

```Shell
ls -l /usr/bin/passwd

-rwsr-xr-x 1 root root 47032 Dec 1 11:45 /usr/bin/passwd
```
  

你会注意到这里有一个新的权限位 **s**。这个权限位是 SUID，当一个文件设置了这个权限位时，它允许启动程序的用户的权限与文件所有者的权限相同，以及执行权限，在这个例子中是 root。所以本质上，当用户运行密码命令时，他们是以 root 身份运行的。

这就是为什么我们在运行 passwd 命令时能够访问受保护文件/etc/shadow。现在如果你移除了这一部分，你会看到你将无法修改/etc/shadow，因此也就无法更改你的密码。

**修改 SUID**

和普通权限一样，修改 SUID 权限有两种方法。

_符号方式：_  

```Shell
sudo chmod u+s myfile
```

_数字方式：_  

 ```Shell
sudo chmod 4755 myfile
```

如您所见，SUID 用数字 4 表示，并加在权限集之前。您可能会看到 SUID 表示为大写的 **S**，这意味着它仍然执行相同的功能，但没有任何执行权限。

## 6. Setgid

类似于设置用户 ID 权限位，还有一个设置组 ID（SGID）权限位。这个位允许程序以该组成员的身份运行。

让我们看一个例子：

```Shell
ls -l /usr/bin/wall
  
-rwxr-sr-x 1 root tty 19024 Dec 14 11:45 /usr/bin/wall
```
  
现在我们可以看到权限位位于组权限集内。

**修改 SGID**

```Shell
sudo chmod g+s myfile
  
sudo chmod 2555 myfile
```
  
SGID 的数值表示为 2。

## 7. 进程权限

让我们稍微谈谈进程权限，记得我告诉过你，当你以 SUID 权限位启用的情况下运行 passwd 命令时，你会以 root 身份运行程序吗？这是真的，但是，这意味着你暂时成为 root 后就可以修改其他用户的密码吗？不，幸运的是不是这样！

这是因为 Linux 实现了许多 UID。每个进程都与三个 UID 相关联：

当你启动一个进程时，它将以运行它的用户或组的相同权限运行，这被称为**有效用户 ID**。这个 UID 用于授予进程访问权限。所以，自然地，如果 Bob 运行了 touch 命令，进程就会以他的身份运行，他创建的任何文件都会属于他的所有。

还有一个 UID，称为**实际用户 ID**，这是启动进程的用户 ID。这些用于追踪启动进程的用户是谁。

最后一个 UID 是**保存用户 ID**，这允许进程在有效用户 ID 和实际用户 ID 之间切换，反之亦然。这很有用，因为我们不希望进程一直以提升的权限运行，在特定时间使用特殊权限是一种良好的实践。

现在让我们通过再次查看 passwd 命令将这些内容整合在一起。

运行 passwd 命令时，你的有效 UID 是你的用户 ID，假设它目前是 500。哦，等等，记得 passwd 命令启用了 SUID 权限。所以当你运行它时，你的有效 UID 现在是 0（0 是 root 的 UID）。现在这个程序可以作为 root 访问文件。

假设你尝到了一点权力的滋味，想要修改 Sally 的密码，Sally 的 UID 是 600。那你就没戏了，幸运的是，该进程也包含了你的真实 UID，在这种情况下是 500。它知道你的 UID 是 500，因此你不能修改 UID 为 600 的密码。（当然，如果你是超级用户，可以控制并更改一切，这总是会被绕过）。

因为你运行了 passwd，进程会以你的真实 UID 启动，并保存文件所有者的 UID（有效 UID），这样你就可以在这两者之间切换。如果不需要，就不必用 root 权限修改所有文件。

大多数情况下，真实 UID 和有效 UID 是相同的，但在 passwd 命令这样的情况下，它们会发生变化。

## 8. 粘滞位

最后我想谈一谈最后一个特殊权限位——粘滞位。

这个权限位“粘滞文件/目录”，这意味着只有所有者或root用户可以删除或修改文件。这对于共享目录非常有用。下面是一个例子：

```Shell
ls -ld /tmp

drwxrwxrwxt 6 root root 4096 Dec 15 11:45 /tmp
```

您会看到末尾有一个特殊的权限位t，这意味着每个人都可以在/tmp目录中添加文件、写入文件、修改文件，但只有root可以删除/tmp目录。

修改粘滞位

```
sudo chmod +t mydir

sudo chmod 1755 mydir
```

粘滞位的数值表示为1